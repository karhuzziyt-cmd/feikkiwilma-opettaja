<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilma</title>
    <style>
        :root {
            --wilma-blue: #003366;
            --text-gray: #8e8e93;
            --border-light: #e5e5ea;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding-bottom: 80px;
        }

        /* YL√ÑPALKKI */
        .header {
            background-color: var(--wilma-blue);
            color: white;
            padding: 20px 15px 40px;
            text-align: center;
        }

        .profile-icon {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ETUSIVUN KORTIT */
        .container { padding: 0 15px; }
        .section-title { color: var(--text-gray); font-size: 12px; margin: 25px 0 10px; text-transform: uppercase; }
        
        .notes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .note-card {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 12px;
            border-left: 6px solid;
            cursor: pointer;
        }

        .note-reason { font-weight: bold; font-size: 15px; }
        .note-sub { font-size: 13px; color: var(--text-gray); margin-top: 2px; }

        /* YKSITYISKOHTAINEN N√ÑKYM√Ñ (MODAL) */
        #detailPage {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #f2f2f7;
            z-index: 1000;
            display: none;
            overflow-y: auto;
        }

        .detail-header {
            background-color: var(--wilma-blue);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
        }

        .back-btn { font-size: 30px; cursor: pointer; margin-right: 20px; }

        .detail-content { padding: 20px; text-align: center; }
        .detail-circle { width: 50px; height: 50px; border-radius: 50%; margin: 0 auto 10px; }
        .detail-title { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        .detail-date { color: #007aff; font-size: 15px; margin-bottom: 25px; }

        .info-box {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: left;
            margin-bottom: 20px;
        }

        .info-label { font-size: 12px; color: var(--text-gray); text-transform: uppercase; margin-bottom: 8px; display: block; }

        /* ALAPALKKI */
        .footer-nav {
            position: fixed; bottom: 0; width: 100%; background: #f9f9f9;
            display: flex; border-top: 1px solid #ddd; padding: 10px 0;
        }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: var(--text-gray); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="mainPage">
        <div class="header">
            <div class="profile-icon"><img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" width="50"></div>
            <div id="userName">Veeti Savolainen</div>
        </div>
        <div class="container">
            <div class="section-title">Lesson Notes</div>
            <div id="notesGrid" class="notes-grid"></div>
        </div>
    </div>

    <div id="detailPage">
        <div class="detail-header">
            <div class="back-btn" onclick="closeDetails()">‚Äπ</div>
        </div>
        <div class="detail-content">
            <div id="detCircle" class="detail-circle"></div>
            <div id="detReason" class="detail-title"></div>
            <div id="detDate" class="detail-date"></div>

            <label class="info-label" style="text-align:left">Group</label>
            <div class="info-box" id="detGroup"></div>

            <label class="info-label" style="text-align:left">Teacher</label>
            <div class="info-box" id="detTeacher"></div>

            <label class="info-label" style="text-align:left">Comments</label>
            <div class="info-box" id="detComment"></div>
            
            <label class="info-label" style="text-align:left">Duration</label>
            <div class="info-box">45</div>
        </div>
    </div>

    <div class="footer-nav">
        <div class="nav-item">üè†<br>Home</div>
        <div class="nav-item">üí¨<br>Messages</div>
        <div class="nav-item">üïí<br>Schedule</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBnBxP9nN_z1nFB_bD4pgbG4W-uwnyN-jk",
            authDomain: "wilma-feikki.firebaseapp.com",
            projectId: "wilma-feikki",
            storageBucket: "wilma-feikki.firebasestorage.app",
            messagingSenderId: "536302104544",
            appId: "1:536302104544:web:41526cb87af29f98790585"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        window.openDetails = (data) => {
            document.getElementById('detReason').innerText = data.reason;
            document.getElementById('detCircle').style.backgroundColor = data.color;
            document.getElementById('detGroup').innerText = data.subject || "Matematiikka";
            document.getElementById('detTeacher').innerText = data.teacher;
            document.getElementById('detComment').innerText = data.comment;
            document.getElementById('detDate').innerText = "T√§n√§√§n klo 12.00"; 
            document.getElementById('detailPage').style.display = "block";
        };

        window.closeDetails = () => {
            document.getElementById('detailPage').style.display = "none";
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const q = query(collection(db, "merkinnat"), where("targetEmail", "==", user.email.toLowerCase().trim()));
                onSnapshot(q, (snap) => {
                    const grid = document.getElementById('notesGrid');
                    grid.innerHTML = "";
                    snap.forEach(doc => {
                        const n = doc.data();
                        const card = document.createElement('div');
                        card.className = 'note-card';
                        card.style.borderLeftColor = n.color;
                        card.onclick = () => openDetails(n);
                        card.innerHTML = `<div class="note-reason">${n.reason}</div>
                                          <div class="note-sub">${n.teacher}</div>
                                          <div class="note-sub" style="font-size:11px">${n.subject}</div>`;
                        grid.appendChild(card);
                    });
                });
            } else {
                signInWithPopup(auth, new GoogleAuthProvider());
            }
        });
    </script>
</body>
</html>
